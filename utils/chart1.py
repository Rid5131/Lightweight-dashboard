import streamlit as st
import pandas as pd
from io import StringIO
from streamlit_lightweight_charts import renderLightweightCharts

# Simulated TSV input
tsv_data = """
timestamp\tdirection\tSupport\tResistance\topen\thigh\tlow\tclose\tvolume
25-08-2022\tSHORT\t[840, 880]\t[900, 895, 940]\t302.542\t302.807\t291.556\t295.897\t6685.7261
26-08-2022\tSHORT\t[877, 880, 840, 835, 845]\t[900, 908, 980.5, 940]\t297.297\t301.956\t287.376\t288.017\t508.559
27-08-2022\tSHORT\t[290]\t[300, 322, 323, 324, 422]\t297.297\t301.956\t287.376\t288.017\t508.559
28-08-2022\tLONG\t[285, 286, 84]\t[290, 292, 295]\t297.297\t301.956\t287.376\t288.017\t508.559
31-08-2022\tSHORT\t[280, 247, 150, 185]\t[287, 288, 292]\t280.497\t280.837\t271.776\t275.337\t94.2867
01-09-2022\tSHORT\t[273, 262]\t[280, 285, 287, 291, 292]\t272.266\t277.497\t266.116\t277.106\t98.0055
02-09-2022\t\t[273, 270, 262, 268, 267]\t[281, 280, 282, 290, 295, 293, 294]\t280.876\t282.116\t269.056\t269.737\t98.136
03-09-2022\tLONG\t[266]\t[280, 282, 281, 285, 290, 286, 288]\t280.876\t282.116\t269.056\t269.737\t98.136
04-09-2022\t\t[266, 262, 267]\t[290, 285, 282, 288]\t280.876\t282.116\t269.056\t269.737\t98.136
08-09-2022\tLONG\t[270, 267]\t[280, 285, 290, 288]\t280.927\t289.477\t279.757\t289.207\t96.0093
09-09-2022\t\t[280, 277]\t[284, 290]\t291.547\t299.817\t291.156\t299.617\t72.2772
10-09-2022\tSHORT\t[285, 286]\t[290, 295]\t291.547\t299.817\t291.156\t299.617\t72.2772
11-09-2022\t\t[290, 400]\t[303, 312, 412]\t291.547\t299.817\t291.156\t299.617\t72.2772
14-09-2022\t\t[290, 285]\t[312, 325]\t292.107\t305.917\t291.556\t302.507\t99.705
15-09-2022\tLONG\t[285, 290]\t[300, 312, 325]\t301.626\t309.077\t300.657\t303.657\t95.3424
16-09-2022\tLONG\t[299]\t[306, 312, 319, 320]\t299.347\t303.637\t295.527\t302.966\t102.8034
17-09-2022\tSHORT\t[]\t[306, 312]\t299.347\t303.637\t295.527\t302.966\t102.8034
18-09-2022\tSHORT\t[250, 255, 292, 293]\t[306]\t299.347\t303.637\t295.527\t302.966\t102.8034
22-09-2022\tSHORT\t[250, 265, 273, 295, 300]\t[312, 313, 317, 318, 325]\t299.996\t301.177\t285.796\t288.467\t134.7309
23-09-2022\tSHORT\t[293, 294, 295]\t[310, 312, 313, 317]\t282.916\t284.307\t272.797\t274.796\t111.6909
24-09-2022\tSHORT\t[285, 280, 276, 262, 250]\t[294, 295, 300]\t282.916\t284.307\t272.797\t274.796\t111.6909
25-09-2022\tLONG\t[275, 273]\t[288, 293, 300]\t282.916\t284.307\t272.797\t274.796\t111.6909
28-09-2022\t\t[275, 274, 273, 267, 262, 257]\t[283, 284, 290, 300]\t282.996\t288.977\t277.506\t287.607\t108.2646
29-09-2022\tSHORT\t[267, 262, 256]\t[288.5, 290]\t282.756\t283.596\t265.737\t268.067\t128.9115
01-10-2022\t\t[267, 262, 256, 248]\t[]\t265.977\t275.507\t262.306\t264.997\t126.1422
02-10-2022\tSHORT\t[265.1, 262, 258, 247, 230, 220, 200, 185, 150]\t[]\t265.977\t275.507\t262.306\t264.997\t126.1422
05-10-2022\tLONG\t[233, 187, 150, 210, 220]\t[247, 264, 267, 270, 272]\t245.302\t246.636\t233.246\t240.457\t101.5821
06-10-2022\tSHORT\t[230, 220, 210, 187, 150, 233]\t[247, 260, 262, 264, 270, 272]\t239.316\t244.496\t235.336\t238.016\t100.4121
07-10-2022\tLONG\t[233]\t[254, 260, 270]\t233.987\t234.527\t222.006\t222.697\t106.5573
08-10-2022\t\t[233, 237, 228, 222]\t[240, 254.61, 270]\t233.987\t234.527\t222.006\t222.697\t106.5573
09-10-2022\tSHORT\t[220, 216, 210, 205, 187, 150]\t[263, 265, 270]\t233.987\t234.527\t222.006\t222.697\t106.5573
12-10-2022\tLONG\t[207]\t[235, 245, 253, 262]\t215.427\t219.226\t211.496\t217.097\t102.8187
13-10-2022\t\t[215, 208, 210, 207, 200]\t[228]\t208.297\t222.947\t206.196\t221.697\t131.598
14-10-2022\t\t[217.32]\t[223, 245]\t223.886\t226.177\t204.146\t204.997\t127.3698
15-10-2022\t\t[]\t[224, 225, 372, 373, 245]\t223.886\t226.177\t204.146\t204.997\t127.3698
16-10-2022\tLONG\t[180, 200]\t[225, 206, 236, 246]\t223.886\t226.177\t204.146\t204.997\t127.3698
19-10-2022\t\t[209, 100, 1100, 185, 205]\t[221, 225, 216]\t219.647\t222.867\t217.746\t222.207\t64.5912
20-10-2022\tLONG\t[217, 219, 216, 210, 150, 180, 204]\t[246, 245, 250]\t208.316\t215.467\t202\t207.036\t84.8448
22-10-2022\t\t[205, 200, 195, 185, 150]\t[]\t206.016\t214.606\t203.746\t214.397\t73.2537
23-10-2022\tLONG\t[203, 202, 205, 200]\t[222, 238, 265, 287]\t206.016\t214.606\t203.746\t214.397\t73.2537
26-10-2022\tLONG\t[198.6, 204, 210]\t[211.25, 215, 230, 243, 250, 253, 379]\t219.116\t230.467\t218.197\t224.506\t73.1034
27-10-2022\tLONG\t[198]\t[222.4, 225, 233, 238, 240, 245, 250, 260, 265, 270]\t229.827\t233.727\t222.776\t224.957\t90.5886
29-10-2022\tLONG\t[212, 213, 216, 218, 220]\t[238, 250, 265]\t225.307\t228.827\t216.227\t228.357\t67.8546
30-10-2022\tLONG\t[216, 225]\t[245, 250, 264, 270]\t225.307\t228.827\t216.227\t228.357\t67.8546
02-11-2022\tLONG\t[204, 205, 218, 225]\t[229, 230]\t225.926\t227.746\t214.756\t214.806\t76.4694
03-11-2022\t\t[]\t[]\t211.026\t221.137\t210.106\t215.307\t64.1529
04-11-2022\tLONG\t[213, 204]\t[235]\t222.537\t223.727\t203.076\t207.467\t84.5766
05-11-2022\tLONG\t[213, 204]\t[220, 230]\t222.537\t223.727\t203.076\t207.467\t84.5766
06-11-2022\tLONG\t[204, 200]\t[230, 250]\t222.537\t223.727\t203.076\t207.467\t84.5766
09-11-2022\tSHORT\t[195, 187, 180, 167, 166, 150]\t[200, 204]\t190.497\t195.837\t177.116\t177.587\t89.5736
10-11-2022\t\t[187, 182, 150, 120]\t[180]\t189.707\t190.977\t180.006\t190.597\t102.9036
11-11-2022\t\t[174, 150, 160]\t[180, 200]\t185.777\t196.477\t182.527\t195.816\t107.7372
12-11-2022\tLONG\t[180, 176, 175, 191]\t[200, 207, 230, 237, 250, 260, 410]\t185.777\t196.477\t182.527\t195.816\t107.7372
13-11-2022\t\t[195, 180, 177]\t[197, 204, 205, 212, 230]\t185.777\t196.477\t182.527\t195.816\t107.7372
16-11-2022\t\t[177, 178, 182, 187, 190, 180]\t[195, 197, 200, 204]\t191.417\t192.467\t185.646\t186.877\t87.2928
17-11-2022\t\t[191, 192, 180]\t[194.44, 197, 196, 200, 204, 400, 406, 410]\t183.637\t186.096\t180.886\t183.177\t84.3984
18-11-2022\tSHORT\t[180, 150]\t[195, 200]\t184.807\t184.886\t176.526\t180.206\t68.2635
19-11-2022\tLONG\t[180.8, 177, 180]\t[183, 184, 195, 200, 204]\t184.807\t184.886\t176.526\t180.206\t68.2635
20-11-2022\tLONG\t[180, 177, 178, 166, 150]\t[182]\t184.807\t184.886\t176.526\t180.206\t68.2635
23-11-2022\tLONG\t[167, 150, 164]\t[180]\t173.627\t183.587\t172.496\t183.087\t88.713
24-11-2022\t\t[161.45, 163, 166]\t[180, 190]\t173.627\t183.587\t172.496\t183.087\t88.713
25-11-2022\tLONG\t[180]\t[182.5, 185, 187, 190, 193, 195, 200, 237]\t185.007\t185.007\t180.616\t182.596\t50.7252
26-11-2022\tLONG\t[182, 180]\t[187, 200, 204, 195, 230, 190]\t185.007\t185.007\t180.616\t182.596\t50.7252
30-11-2022\tLONG\t[183, 175, 176, 166, 170]\t[190, 187, 185, 200, 205, 195, 220, 230, 280]\t182.346\t194.657\t180.596\t194.446\t95.8707
01-12-2022\tLONG\t[166, 176, 177, 179, 180]\t[183, 184, 221]\t196.907\t198.817\t191.757\t194.657\t76.5846
02-12-2022\tLONG\t[167, 178, 186, 187, 188]\t[195, 204, 205, 220, 230]\t191.596\t196.217\t191.096\t194.727\t78.1164
03-12-2022\tLONG\t[186, 187, 189, 190]\t[200, 216]\t191.596\t196.217\t191.096\t194.727\t78.1164
04-12-2022\tLONG\t[186, 190, 187]\t[195, 196, 205, 215, 200]\t191.596\t196.217\t191.096\t194.727\t78.1164
07-12-2022\tLONG\t[182, 178, 176, 177, 167, 165]\t[185, 187, 198, 200, 204, 220, 230]\t174.906\t179.367\t172.196\t173.977\t96.1794
08-12-2022\tLONG\t[177, 38.55]\t[400, 25, 195, 200]\t171.956\t175.167\t169.026\t173.356\t88.5933
09-12-2022\t\t[170, 167, 168, 165, 160, 155]\t[176, 177, 180, 198, 201]\t173.707\t182.487\t173.296\t178.966\t82.6956
10-12-2022\tLONG\t[169, 167, 168]\t[400, 402]\t173.707\t182.487\t173.296\t178.966\t82.6956
11-12-2022\t\t[170, 136, 91, 74, 59, 55, 43, 29, 30, 17]\t[180, 185, 205]\t173.707\t182.487\t173.296\t178.966\t82.6956
14-12-2022\t\t[167, 166]\t[180]\t159.197\t161.577\t155.296\t156.746\t104.6277
15-12-2022\t\t[136, 150, 157]\t[161, 167, 180]\t153.307\t160.827\t153.246\t157.657\t106.2996
16-12-2022\tLONG\t[150, 152, 153]\t[164, 170, 180]\t159.527\t160.836\t150.026\t150.156\t88.8012
17-12-2022\tLONG\t[155, 156, 150]\t[178, 170]\t159.527\t160.836\t150.026\t150.156\t88.8012
18-12-2022\tLONG\t[150, 147, 136, 120, 118, 110]\t[175, 170, 180]\t159.527\t160.836\t150.026\t150.156\t88.8012
21-12-2022\tLONG\t[150, 146]\t[154, 170, 180]\t139.307\t141.216\t135.887\t137.377\t91.7771
22-12-2022\tSHORT\t[136, 130, 120, 112, 104]\t[150, 143, 166, 167]\t135.987\t136.486\t122.256\t125.276\t116.064
23-12-2022\t\t[137.49, 135, 130, 120, 17]\t[139, 160, 165, 265]\t126.336\t128.587\t121.016\t123.006\t97.0488
24-12-2022\t\t[125, 120, 110, 112, 100, 91, 65, 167, 150, 130]\t[133]\t126.336\t128.587\t121.016\t123.006\t97.0488
25-12-2022\tLONG\t[121, 120, 112, 100]\t[192, 175, 180, 165, 160, 170, 150]\t126.336\t128.587\t121.016\t123.006\t97.0488
29-12-2022\tLONG\t[112, 102, 100, 70]\t[166, 180, 150]\t120.316\t123.547\t117.496\t121.806\t117.0063
30-12-2022\tLONG\t[112, 110, 100, 60, 70]\t[150, 166, 180, 143, 165]\t119.966\t124.427\t119.657\t123.126\t131.4048
31-12-2022\tLONG\t[114, 115]\t[123, 150, 116]\t119.966\t124.427\t119.657\t123.126\t131.4048
01-01-2023\tLONG\t[123, 124]\t[150, 160]\t119.966\t124.427\t119.657\t123.126\t131.4048
05-01-2023\tLONG\t[109, 100, 107, 104, 70]\t[150, 160, 180]\t110.456\t111.717\t107.157\t110.336\t144.4971
06-01-2023\tLONG\t[60, 90, 108]\t[121, 123, 125, 140, 150, 162]\t102.916\t114.377\t101.2\t112.976\t108.3354
07-01-2023\tLONG\t[100, 105]\t[140]\t102.916\t114.377\t101.2\t112.976\t108.3354
08-01-2023\tLONG\t[100, 61, 64]\t[120, 125, 140, 150, 390, 400]\t102.916\t114.377\t101.2\t112.976\t108.3354
11-01-2023\tLONG\t[115, 116, 118]\t[150, 180, 200, 300]\t102.916\t114.377\t101.2\t112.976\t108.3354
12-01-2023\tLONG\t[117, 118]\t[151, 153, 160]\t102.916\t114.377\t101.2\t112.976\t108.3354
13-01-2023\tLONG\t[115, 117]\t[150, 160, 180]\t102.916\t114.377\t101.2\t112.976\t108.3354
14-01-2023\tLONG\t[115, 117, 118]\t[150, 180]\t102.916\t114.377\t101.2\t112.976\t108.3354
15-01-2023\tLONG\t[115, 117, 118]\t[150, 180]\t102.916\t114.377\t101.2\t112.976\t108.3354
16-01-2023\tLONG\t[115, 117, 118]\t[150, 180]\t102.916\t114.377\t101.2\t112.976\t108.3354
03-02-2023\tLONG\t[112, 122, 133, 144, 150, 160]\t[180, 190, 194, 200]\t183.937\t198.977\t183.667\t189.917\t104.22
04-02-2023\tSHORT\t[177, 180, 181, 380]\t[190, 195, 197, 200, 210, 220, 410]\t183.937\t198.977\t183.667\t189.917\t104.22
05-02-2023\tSHORT\t[100, 122, 140, 144, 150, 162, 177, 180]\t[192, 199, 200]\t183.937\t198.977\t183.667\t189.917\t104.22
08-02-2023\t\t[]\t[195, 198, 200, 210, 220]\t195.987\t202.816\t194.316\t201.186\t95.7303
09-02-2023\tSHORT\t[100, 120, 150]\t[200, 210, 220]\t207.657\t213.977\t204.736\t207.217\t124.4115
10-02-2023\t\t[150, 200, 100]\t[210, 220, 230]\t202.136\t206.146\t192.896\t196.737\t107.0775
11-02-2023\tSHORT\t[144, 170, 160, 150]\t[210, 214, 220, 207, 230, 226]\t202.136\t206.146\t192.896\t196.737\t107.0775
12-02-2023\tSHORT\t[158, 144, 160, 145]\t[210, 215, 208, 200]\t202.136\t206.146\t192.896\t196.737\t107.0775
15-02-2023\tSHORT\t[180, 170, 150, 160, 140, 185]\t[200, 197]\t211.746\t214.637\t206.106\t214.046\t94.7646
16-02-2023\tSHORT\t[150]\t[210, 213, 220]\t210.687\t217.617\t201.796\t201.907\t169.3026
17-02-2023\tSHORT\t[140, 150, 160, 166, 170]\t[214, 215, 220, 225, 230]\t199.986\t208.407\t197.487\t208.176\t170.5617
18-02-2023\tSHORT\t[200, 190, 185, 160, 146, 170, 150, 155, 180]\t[218, 220, 210, 214, 217]\t199.986\t208.407\t197.487\t208.176\t170.5617
19-02-2023\tSHORT\t[160, 180, 190, 200, 144, 122, 181, 185, 150, 155, 170, 146]\t[210, 212, 213, 214, 217, 220, 222, 265]\t199.986\t208.407\t197.487\t208.176\t170.5617
23-02-2023\tSHORT\t[190, 185, 160, 146, 145]\t[200, 210, 213, 230]\t203.796\t205.057\t196.316\t201.946\t117.8946
24-02-2023\tSHORT\t[187, 190, 160, 140]\t[200, 201, 202, 203, 205, 207, 208, 210, 213]\t196.296\t197.646\t192.787\t196.797\t149.211
25-02-2023\t\t[145, 160, 174, 190, 191.9, 192]\t[205, 210, 216, 220, 222]\t196.296\t197.646\t192.787\t196.797\t149.211
26-02-2023\tSHORT\t[190]\t[200]\t196.296\t197.646\t192.787\t196.797\t149.211
01-03-2023\tSHORT\t[197, 200]\t[208, 209.43, 210, 213, 215]\t205.996\t207.177\t198.497\t202.587\t116.5728
02-03-2023\tSHORT\t[200]\t[210, 213, 215]\t186.677\t193.707\t186.006\t190.926\t124.488
03-03-2023\tSHORT\t[145, 150, 160, 180, 190, 200]\t[213, 215, 216]\t194.696\t200.457\t192.876\t197.867\t84.933
04-03-2023\tSHORT\t[145, 160, 170, 173, 177, 177.5, 180, 190, 191, 192]\t[197, 200, 218]\t194.696\t200.457\t192.876\t197.867\t84.933
05-03-2023\tSHORT\t[160, 145]\t[200, 203, 408]\t194.696\t200.457\t192.876\t197.867\t84.933
08-03-2023\tSHORT\t[190, 185, 180, 160, 145, 177]\t[205]\t184.946\t186.416\t179.996\t181.967\t122.9625
09-03-2023\tSHORT\t[180, 160, 145, 177]\t[185, 186, 187, 190]\t180.177\t185.127\t172.496\t172.816\t137.8638
10-03-2023\tSHORT\t[180, 162, 145]\t[187, 190, 191, 192]\t174.987\t178.266\t168.426\t173.296\t117.0153
11-03-2023\tSHORT\t[180, 160, 146, 145, 130]\t[185, 187, 190]\t174.987\t178.266\t168.426\t173.296\t117.0153
12-03-2023\tSHORT\t[173, 145, 150, 162, 168]\t[190]\t174.987\t178.266\t168.426\t173.296\t117.0153
15-03-2023\tSHORT\t[173, 171, 160, 145]\t[176, 184, 190]\t180.736\t182.296\t176.006\t180.237\t206.4216
16-03-2023\tLONG\t[175, 174, 146, 150, 145]\t[190, 214, 213]\t180.197\t185.747\t178.826\t184.017\t135.1956
17-03-2023\tLONG\t[180]\t[188, 192, 190, 187]\t184.386\t186.147\t177.316\t180.007\t141.6732
18-03-2023\tSHORT\t[]\t[192, 187, 190]\t184.386\t186.147\t177.316\t180.007\t141.6732
19-03-2023\tSHORT\t[177]\t[186, 190, 210]\t184.386\t186.147\t177.316\t180.007\t141.6732
22-03-2023\tSHORT\t[170, 160, 145]\t[183, 200, 210, 215]\t199.246\t200.606\t190.917\t190.917\t128.4432
23-03-2023\tSHORT\t[190, 180, 185]\t[200, 210, 215, 214]\t195.247\t199.277\t188.606\t192.156\t175.0272
24-03-2023\tSHORT\t[187, 180, 183, 185]\t[210, 215, 200]\t191.497\t192.277\t187.147\t190.316\t125.8848
25-03-2023\t\t[190, 187, 188, 186, 140]\t[200, 210, 215]\t191.497\t192.277\t187.147\t190.316\t125.8848
26-03-2023\t\t[188, 187, 190, 160, 145, 215]\t[200, 210]\t191.497\t192.277\t187.147\t190.316\t125.8848
29-03-2023\tSHORT\t[190, 180, 170]\t[210, 215, 220]\t188.797\t191.717\t184.777\t190.736\t116.8344
30-03-2023\tSHORT\t[170, 180]\t[190, 195, 200]\t189.937\t191.917\t182.737\t188.317\t135.8922
31-03-2023\tSHORT\t[170, 180, 190, 200]\t[210, 215]\t191.297\t193.577\t188.707\t191.116\t113.8626
01-04-2023\tSHORT\t[185, 187, 190]\t[200, 210]\t191.297\t193.577\t188.707\t191.116\t113.8626
04-04-2023\tSHORT\t[185, 186]\t[200, 210]\t191.297\t193.577\t188.707\t191.116\t113.8626
05-04-2023\tSHORT\t[180, 187]\t[200, 210]\t191.297\t193.577\t188.707\t191.116\t113.8626
06-04-2023\tSHORT\t[188, 180]\t[200, 210]\t191.297\t193.577\t188.707\t191.116\t113.8626
07-04-2023\tSHORT\t[190]\t[200, 210]\t191.297\t193.577\t188.707\t191.116\t113.8626
08-04-2023\tSHORT\t[190, 188]\t[200, 210]\t191.297\t193.577\t188.707\t191.116\t113.8626

"""

# Load and process
df = pd.read_csv(StringIO(tsv_data), sep="\t")
df['timestamp'] = pd.to_datetime(df['timestamp'], dayfirst=True)
df = df.dropna(subset=['open', 'high', 'low', 'close'])  # Important

# Create candlestick series data
candlestick_series = [
    {
        "time": row["timestamp"].strftime("%Y-%m-%d"),
        "open": float(row["open"]),
        "high": float(row["high"]),
        "low": float(row["low"]),
        "close": float(row["close"])
    }
    for _, row in df.iterrows()
]

# Chart and series options
candlestick_chart = {
    "height": 400,
    "layout": {
        "background": {"type": "solid", "color": "#ffffff"},
        "textColor": "#000"
    }
}

candlestick_series_config = [
    {
        "type": "Candlestick",
        "data": candlestick_series,
        "options": {
            "upColor": "#26a69a",
            "downColor": "#ef5350",
            "borderVisible": False,
            "wickUpColor": "#26a69a",
            "wickDownColor": "#ef5350"
        }
    }
]

# Render chart
st.subheader("Candlestick Chart - Your Sample Data")
renderLightweightCharts([
    {
        "chart": candlestick_chart,
        "series": candlestick_series_config
    }
])

